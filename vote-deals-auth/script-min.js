const Begin=function(t){class s{constructor(t){this.NAME="Vote Deals",this.TANDC="Vote Deals T & C",this.LOAD_DATA="load data",this.SUBMIT="submit",this.FROM_INTERVAL="interval",this.FROM_INITIALIZE="initialize",this.VOTES_AVAILABLE="votes available",this.ID="vote_deals",this.MS_INTERVAL_BTW_FETCHES=10,this.VOTED_LIST="voted-list",this.VOTED_DEALS="voted-deals",this.FOCUS="focus",this.BUILD="build",this.FIRST_TAB="first tab",this.TAB_LISTENER="tab listener",this.CURRENCY=t.config.currency,this.VOTE_CLASS="-vote-btn",this.VOTED="voted",this.UNVOTED="unvoted",this.time_interval=null,this.minute_duration=parseInt(t.config.minute_duration_vote_deals),this.redirect="https://www.jumia.com.ng/customer/account/login/?return=https%3A%2F%2Fwww.jumia.com.ng%2Fsp-vote%2F",this.config=t.config,this.domain=t.domain,this.user=null,this.num2Array=t=>Array.from(Array(t).keys()),this.el=(t,s)=>s?s.querySelector(t):document.querySelector(t),this.all=(t,s)=>s?s.querySelectorAll(t):document.querySelectorAll(t),this.midnight=()=>(new Date).setHours(0,0,0,0),this.jsonFrLStorage=(t,s)=>JSON.parse(localStorage.getItem(t))||s,this.jsonToLStorage=(t,s)=>localStorage.setItem(t,JSON.stringify(s)),this.getData=(t,s)=>t.json_list.filter((t=>t[s.key]===s.name)),this.endTime=t=>t+60*this.minute_duration*1e3,this.isItMyTime=(t,s)=>+new Date(t.time)===parseInt(s),this.isPast=t=>Date.now()>t&&Date.now()>this.endTime(t),this.isFuture=(t,s)=>-1===s.indexOf(t),this.isATab=t=>t.classList.contains("-tab"),this.pad=t=>1==t.toString().length?"0"+t:t,this.skuRows=()=>this.all(".-sku_row"),this.capitalize=t=>t[0].toUpperCase()+t.slice(1),this.skuRow=t=>this.el('.-sku_row[data-time="'+t+'"]'),this.skuID=t=>t.category+"_"+t.sku+"_"+t.time,this.groupID=(t,s)=>this.id(t+"-"+this.fullDate(s).toLowerCase().split(" ").join("-"),"-"),this.voteTxt=t=>`${t} vote(s)`,this.randomize=t=>t.sort((()=>Math.random()-.5)),this.reverse=t=>t.reverse()}assignBgColor(t){var s=this.all(".-sku",t),e=Array.from(s).map((t=>parseInt(t.getAttribute("data-votes")))),i=e.filter(((t,s,e)=>e.indexOf(t)!==s)),a=Math.min(...e),r=Math.max(...e);s.forEach((t=>this.assignColor({sku:t,min:a,max:r,duplicates:i})))}assignColor({sku:t,min:s,max:e,duplicates:i}){t.querySelector(".-tags"),t.querySelector(".-vote-btn");var a=t.getAttribute("data-votes");parseInt(a)===e?t.setAttribute("data-color","green"):parseInt(a)===s?t.setAttribute("data-color","red"):t.setAttribute("data-color","orange"),-1!==i.indexOf(parseInt(a))&&t.setAttribute("data-color","orange")}isANumber(t){const s=t.split(" ").filter((t=>!isNaN(t)))[0];return isNaN(s)?null:s}discount(t,s){const e=this.isANumber(t),i=this.isANumber(s);if(!isNaN(e)){var a=100*(parseInt(e)-parseInt(i))/parseInt(e);return isNaN(a)?"":"-"+Math.round(a)+"%"}return null}replacePattern(t,s){var e=new RegExp(t,"g");return s.replace(e,"-")}id(t,s){var e=this.replacePattern("'",t),i=this.replacePattern("&",e),a=this.replacePattern("%",i),r=this.replacePattern(":",a);this.replacePattern(";",r);return r.toLowerCase().split(" ").join(s)}badge(t){var s=this.id(t.type,"_"),e=this.config[s+"_icon"],i="Generic"===t.type?"Limited Stock":t.type,a=e?`<img class="lazy-image" data-src="${e}" alt="sku_img"/>`:i;return e?`<div class="-tag -inlineblock -vamiddle -b-img -${this.id(t.type,"-")}">${a}</div>`:`<div class="-tag -inlineblock -vamiddle -${this.id(t.type,"-")}" style="background-color:${this.config[t.type]}">${a}</div>`}toggleClass(t,s,e){t.forEach((t=>t.classList.remove(e))),s.classList.add(e)}times(t){var s=t.map((t=>+new Date(t.time))),e=Array.from(new Set(s));const i=this.platform().dateRange.split("-"),a=+new Date(i[0]),r=+new Date(i[1]);return e.filter((t=>t>=a&&t<=r)).sort(((t,s)=>t-s))}pastAndFutureTimes(t){var s=t.filter(this.isPast),e=t.filter((t=>this.isFuture(t,s)));return{past:s,future:e}}timeUnits(t){var s=new Date(t);return{day:s.getDay(),month:s.getMonth(),date:s.getDate(),hr:s.getHours(),mn:s.getMinutes()}}twelveHrFormat(t,s){return 12===t?this.pad(t)+":"+this.pad(s)+"pm":t>12?this.pad(t-12)+":"+this.pad(s)+"pm":0===t?"12:"+this.pad(s)+"am":this.pad(t)+":"+this.pad(s)+"am"}dayDiff(t){var s=new Date(t).getDate();return(new Date).getDate()-s}sameMonth(t){return new Date(t).getMonth()===(new Date).getMonth()}date(t){var s=this.dayDiff(t);return 0===s&&this.sameMonth(t)?this.capitalize("today"):1===s&&this.sameMonth(t)?this.capitalize("yesterday"):-1===s&&this.sameMonth(t)?this.capitalize("tomorrow"):this.fullDate(t)}fullDate(t){var s=new Date(t),e=s.toLocaleDateString("en-US",{month:"short"});return s.toLocaleDateString("en-US",{weekday:"short"})+" "+e+" "+s.getDate()}group(t,s){return s.map((s=>{var e=t.filter((t=>this.isItMyTime(t,s)));return{time:s,skus:e}}))}platform(){var t="ontouchstart"in window,s=this.config[this.ID+"_date_range"];return{banner:t?this.config[this.ID+"_mobile_banner"]:this.config[this.ID+"_desktop_banner"],live_link:t?this.config[this.ID+"_deeplink"]:this.domain.host+"/"+this.config.download_apps_page,dateRange:s,currencyPosition:this.config.currency_position}}show(t){return this.image_observer=new feature_box.ImageObserver(t),this.image_observer=null,this}}class e extends s{constructor(t){super(t),this.tabBounds$={},this.tabs=this.el(".-all-tabs"),this.tabsParent=this.el(".-tabs"),this.prev=this.el(".-control.-prev"),this.next=this.el(".-control.-next"),feature_box.pubsub.subscribe(this.BUILD,this.build.bind(this)),this.tabs.addEventListener("click",this.tabListener.bind(this))}reset(){this.tabBounds$={},this.tabs.innerHTML=""}build(t){this.reset();const s=t.reorderedTimes;this.tabs.innerHTML=s.map(this.createTab.bind(this)).join(""),s.map(this.tabBounds.bind(this));const e=this.all(".-tab")[0];this.setTabProps(e,this.FIRST_TAB),!1===feature_box.is_mobile&&this.scrollListener()}scrollListener(){this.next.addEventListener("click",this.scrollToNext.bind(this)),this.prev.addEventListener("click",this.scrollToPrev.bind(this))}scrollToNext(){const t=this.tabs.scrollLeft+50,s=this.tabs.scrollLeft+300-t;this.tabs.scrollLeft=t+1*s}scrollToPrev(){const t=this.tabs.scrollLeft-50,s=this.tabs.scrollLeft-300-t;this.tabs.scrollLeft=t+1*s}createTab(t,s){const e=0==s?"-tab active -inlineblock -posrel -vamiddle":"-tab -inlineblock -posrel -vamiddle",i=this.timeUnits(t);return`<a href="#top" class="${e}" data-time="${t}"><span class="-posabs -preloader -loading"></span><span class="-time">${this.twelveHrFormat(i.hr,i.mn)}</span><span>${this.date(t)}</span></a>`}tabListener(t){const s=t.target.parentElement;this.isATab(s)&&this.setTabProps(s,this.TAB_LISTENER)}setTabProps(t,s){this.toggleClass(this.all(".-tab"),t,"active"),s===this.TAB_LISTENER&&feature_box.pubsub.emit(this.FOCUS,t.getAttribute("data-time"))}tabBounds(t,s){const e=this.el('.-tab[data-time="'+t+'"]');this.tabBounds$[t]=e.getBoundingClientRect()}}class i extends s{constructor(t,s){super(t),this.skusEl=this.el(".-skus"),this.votedDeals={},this.user=s,feature_box.pubsub.subscribe(this.VOTES_AVAILABLE,(t=>{this.votedDeals=t,this.updateUiWithVotes()})),this.skusEl.addEventListener("click",this.vote.bind(this))}vote(t){const s=t.target;if(s.classList.contains(this.VOTE_CLASS)){const t=s.parentElement;this.updateVotedDeals(t),this.updateUiWithVotes()}}updateVotedDeals(t){const s=t.getAttribute("data-id");if((this.votedDeals[s]?this.votedDeals[s][this.user.email]:void 0)!==this.VOTED){var e={};e[this.user.email]=this.VOTED,this.votedDeals[s]=e}else this.votedDeals[s][this.user.email]=this.UNVOTED;this.jsonToLStorage(this.VOTED_DEALS,this.votedDeals),feature_box.pubsub.emit(this.SUBMIT,this.votedDeals)}imageCTAUpdate(t){(this.votedDeals[t]?this.votedDeals[t][this.user.email]:void 0)===this.VOTED?this.updateImageAndCTA({skuId:t,action:"add",text:"unvote"}):this.updateImageAndCTA({skuId:t,action:"remove",text:"vote"})}updateImageAndCTA({skuId:t,action:s,text:e}){const i=this.el(`.-sku[data-id="${t}"]`),a=this.el(".-cta",i);i.parentElement.classList[s]("-voted"),i.classList[s]("-sku-voted"),a&&(a.textContent=e)}updateUiWithVotes(){Object.keys(this.votedDeals).map((t=>{if(this.el(`.-sku[data-id="${t}"]`)){const s=this.obj(t);return this.updateVoteCount(s),this.assignBgColor(s.section),this.updateImageAndCTA({skuId:t,action:"remove",text:"vote"}),t}return null})).filter((t=>null!==t)).filter((t=>!(!this.votedDeals[t][this.user.email]||this.votedDeals[t][this.user.email]!==this.VOTED))).map((t=>this.updateImageAndCTA({skuId:t,action:"add",text:"unvote"})))}obj(t){const s=this.votedDeals[t],e=this.decouple(t),i=this.el(`.-sku[data-time="${e.time}"][data-sku="${e.sku}"]`),a=i.parentElement;this.el(".-cta",i);return{section:a,skuEl:i,emailMap:s}}decouple(t){const s=t.split("_");return{category:s[0],sku:s[1],time:s[2]}}updateVoteCount({section:t,skuEl:s,emailMap:e}){const i=Object.keys(e).filter((t=>e[t]===this.VOTED)).length;this.all(".-sku",t);this.el(".-count",s).textContent=this.voteTxt(i),s.setAttribute("data-votes",i)}}class a extends s{constructor(t){super(t),this.json=t,this.rowBounds$={},this.user={},this.loggedIn=!1,this.mounted=!1,this.skusEl=this.el(".-skus"),this.authenticate(),feature_box.pubsub.subscribe(this.FOCUS,this.inFocus.bind(this)),feature_box.pubsub.subscribe(this.BUILD,this.display.bind(this))}display(t){this.reset().displaySKUs(t).activateVoteController()}reset(){return this.rowBounds$={},this.skusEl.innerHTML="",this}activateVoteController(){this.voteController=new i(this.json,this.user)}inFocus(t){const s=this.skuRows(),e=this.skuRow(t);this.toggleClass(s,e,"active")}displaySKUs(t){this.skusEl.innerHTML=t.groupedSKUs.map(this.rowHTML.bind(this)).join("");const s=this.all(".-sku_row")[0].getAttribute("data-time");return this.inFocus(s),feature_box.pubsub.emit(this.FOCUS,s),this.show(this.skusEl),this}rowHTML(t,s){let e=t.skus.map((t=>t.category));e=[...new Set(e)],e=this.randomize(e);const i=e.reduce(((s,e)=>(s[e]=t.skus.filter((t=>t.category===e)),s)),{}),a=this.createSections(i);return this.createRow(t,s,a)}createSections(t){return Object.keys(t).map((s=>this.sectionHtml(t[s],s))).join("")}sectionHtml(t,s){const e=t[0];let i=`<div class="-section" data-group-id="${this.groupID(e.category,e.time)}"><div class="-title">${s}</div><div class="-sku-group">`;return i+=t.map(this.singleHtml.bind(this)).join(""),i+="</div></div>",i}singleHtml(t){var s=t.old_price,e=t.new_price,i=this.discount(t.old_price,t.new_price);const a=null===this.isANumber(t.old_price)?"":`<div class="-discount -price -posabs">${i}</div>`,r=null===this.isANumber(t.old_price)?"":`<div class="-price -old">${s}</div>`;var n=this.loggedIn?`<div class="-cta -posabs ${this.VOTE_CLASS}">vote</div>`:`<a class="-redirect -posabs" href="${this.redirect}">log in</a>`;return`<div class="-sku -posrel" data-votes="0" data-id="${this.skuID(t)}" data-color="orange" data-time="${t.time}" data-sku="${t.sku}" data-category="${t.category}"><a href="${t.pdp}" class="-img -posabs"><div class="-posabs -shadow"><span class="-posabs">voted</span></div><img class="lazy-image loaded" data-src="${t.image}" alt="sku_img"/><div class="-preloader -posabs"></div></a><div class="-details -posabs"><div class="-name">${t.name}</div><div class="-desc">${t.desc}</div><div class="-prices"><div class="-price -new">${e}</div>${r}</div>${a}</div>${n}<div class="-tags -posabs">${this.voteHTML(0)}</div></div>`}voteHTML(t){return`<div class="-inlineblock -vamiddle -arrow"></div><div class="-inlineblock -vamiddle -count">${this.voteTxt(t)}</div>`}createRow(t,s,e){return`<div class="${0===s?"-sku_row -posrel active":"-sku_row -posrel"}" data-time="${t.time}">${e}</div>`}authenticate(){if(/loaded|complete/.test(document.readyState)){const t=store.customer.email;this.user={email:t},this.loggedIn=t.length>0}}}class r extends s{constructor(t){super(t),this.comingTimes=()=>this.times().filter((t=>Date.now()<t)),this.timeElapsedSinceMidnight=()=>new Date-new Date(this.midnight()),this.nextTime=()=>this.comingTimes()[0],this.initializeClock=t=>this.timeInterval=setInterval((()=>this.toUpdateClock(t)),1e3),this.minuteToMillisecs=t=>60*t*1e3,this.clockEl=this.el("#clock"),this.reset()}reset(){this.minutesInADay=1440,this.minutesInMs=6e4,clearInterval(this.timeInterval),this.initializeClock(this.nextTime())}toUpdateClock(t){const s=this.remainingTime(t);s.t<=0&&(this.reset(),feature_box.pubsub.emit(this.LOAD_DATA,this.FROM_INTERVAL)),this.clockEl.innerHTML=`${("0"+s.minutes).slice(-2)}m : ${("0"+s.seconds).slice(-2)}s`}remainingTime(t){const s=+new Date(t)-Date.now(),e=Math.floor(s/1e3%60),i=Math.floor(s/1e3/60%60),a=Math.floor(s/36e5%24);return{t:s,days:Math.floor(s/864e5),hours:a,minutes:i,seconds:e}}times(){const t=Math.round(this.minutesInADay/this.MS_INTERVAL_BTW_FETCHES);return this.num2Array(t).map((t=>{const s=t+1,e=this.MS_INTERVAL_BTW_FETCHES*s-this.MS_INTERVAL_BTW_FETCHES;return this.midnight()+e*this.minutesInMs}))}}class n extends s{constructor(t){super(t),this.initialize(t),this.regExReplace=t=>t.replace(/\"|\,/g,""),this.clone=t=>JSON.parse(JSON.stringify(t)),this.send=t=>feature_box.pubsub.emit(this.VOTES_AVAILABLE,t),this.configs=this.configStr.map(this.str2Obj.bind(this)).map(this.configObj.bind(this)).map(this.firestore.bind(this)),feature_box.pubsub.subscribe(this.LOAD_DATA,this.load.bind(this)),feature_box.pubsub.subscribe(this.SUBMIT,this.submit.bind(this))}initialize(t){this.json=t,this.configStr=["projectId==jumia-vote-deals|messagingSenderId==15013363201|apiKey==AIzaSyC8htXCQ-5Tm_qCKgbVBQaS_Enu5zQmIeU|appId==1:15013363201:web:d8ed9ec2a4f2f331d50a00"],this.db_idx=0}str2Obj(t){return this.regExReplace(t).split("|").reduce(this.reducer.bind(this),{})}reducer(t,s){const e=s.split("==");return t[e[0]]=e[1]?e[1].toLocaleString():e[1],t}configObj(t){return{...this.clone(t),...{authDomain:t.projectId+".firebaseapp.com",databaseURL:"https://"+t.projectId+".firebaseio.com",storageBucket:t.projectId+".appspot.com"}}}firestore(t){let s=firebase.initializeApp(t,t.projectId),e=s.auth();e.onAuthStateChanged((t=>{this.user=t,this.signIn(e)}));let i={firestore:s.firestore()};return{...t,...i}}signIn(t){t.signInWithEmailAndPassword(this.json.email,this.json.password).then((t=>this.load(this.FROM_INITIALIZE))).catch((s=>{"auth/user-not-found"===s.code&&this.signUp(t)}))}signUp(t){t.createUserWithEmailAndPassword(this.json.email,this.json.password).then((t=>{})).catch((t=>{}))}load(t){const s=this.dbIdx(t),e=this.configs[s];this.get(e.firestore,this.ID).then(this.onSuccess.bind(this)).catch(this.onError.bind(this))}onSuccess(t){this.jsonToLStorage(this.VOTED_DEALS,t),this.send(t)}onError(t){const s=this.jsonFrLStorage(this.VOTED_DEALS,{});this.send(s)}dbIdx(t){return t===this.FROM_INTERVAL?(this.db_idx++,this.db_idx>=this.configs.length?0:this.db_idx):this.db_idx}submit(t){this.user&&this.configs.map((s=>{this.save(s.firestore,t).then((()=>{})).catch((t=>{}))}))}save(t,s){return t.collection(this.ID).doc("data").set(s,{merge:!0})}get(t,s){return t.collection(s).doc("data").get().then((t=>t.exists?t.data():{})).catch((t=>{}))}}new class extends s{constructor(t){super(t),this.database=new n(t),this.time=new r(t),this.tabs=new e(t),this.skuRows=new a(t),this.data=this.getData(t,{key:"initiative",name:this.NAME}),this.tandcs=this.getData(t,{key:"initiative",name:this.TANDC}),this.tandcEl=this.el(".-re.-rules"),this.hiwCTA=this.el(".-how-it-works"),this.hiwCTA.addEventListener("click",this.toggleBanner.bind(this)),this.topBanner=this.el(".-banner.-top"),this.init().setBanner().displayTAndCs().show()}init(){const t=this.times(this.data),s=this.pastAndFutureTimes(t);let e=s.future.concat(s.past);e=this.randomize(e);const i=this.group(this.data,e);return feature_box.pubsub.emit(this.BUILD,{reorderedTimes:e,groupedSKUs:i}),this}setBanner(){return this.el(".-banner.-top img.lazy-image").setAttribute("data-src",this.platform().banner),this}displayTAndCs(){return this.tandcEl.innerHTML=this.tandcs.map(this.tandcHTML.bind(this)).join(""),this}tandcHTML(t){return`<div class="-rule_element"><div class="-inlineblock -vatop -num">${t.sku}.</div><div class="-inlineblock -vatop -desc">${t.name}</div></div>`}toggleBanner(t){this.topBanner.classList.toggle("-show");let s=this.el(".-txt",this.hiwCTA);s.textContent="How It Works (T&Cs)"===s.textContent?"Close":"How It Works (T&Cs)"}}(t)},currentUser={isLoggedIn:!1,email:"",pw:""};let feature_box;const interval=setInterval((()=>{if(/loaded|complete/.test(document.readyState)&&(clearInterval(interval),currentUser.email=store.customer.email,currentUser.pw=btoa(currentUser.email.split("").reverse().join("")),currentUser.email.length>0)){currentUser.isLoggedIn=!0;const t=currentUser.email,s=currentUser.pw;feature_box=Featurebox({config:{apiKey:"AIzaSyC8htXCQ-5Tm_qCKgbVBQaS_Enu5zQmIeU",authDomain:"jumia-vote-deals.firebaseapp.com",projectId:"jumia-vote-deals",storageBucket:"jumia-vote-deals.appspot.com",messagingSenderId:"15013363201",appId:"1:15013363201:web:d8ed9ec2a4f2f331d50a00",measurementId:"G-GNT4HGW9Z3"},name:"vote_deals"}),feature_box.pubsub.subscribe(feature_box.DATA_ARRIVES,(e=>{Begin({...e,email:t,password:s})}))}}),10);