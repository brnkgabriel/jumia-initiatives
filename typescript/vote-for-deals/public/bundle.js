(()=>{"use strict";const t=["projectId==jumia-vote-deals|messagingSenderId==15013363201|apiKey==AIzaSyC8htXCQ-5Tm_qCKgbVBQaS_Enu5zQmIeU|appId==1:15013363201:web:d8ed9ec2a4f2f331d50a00"],s="voted-deals",e="vote_deals_categories",i="focus",a="grouped",o="tab listener",r=".-sku_row",n="click",c="Terms & Conditions",l="active",d="next",h="-sku_row -posrel",u=t=>"#initiative "+t,p=t=>'.-tab[data-category="'+t+'"]';class g{constructor(t,s){this.timeInterval=0,this.remoteData=t,this.minutesDuration=Number(this.remoteData.config.minute_duration_campaign_calendar),this.currency=this.remoteData.config.currency,this.config=this.remoteData.config,this.domain=this.remoteData.domain,this.fbox=s,this.el=t=>document.querySelector(u(t)),this.all=t=>document.querySelectorAll(u(t)),this.allCategories=t=>[...new Set(t.map((t=>t.category)))],this.pad=t=>1==t.toString().length?"0"+t:t,this.endTime=t=>t+60*this.minutesDuration*1e3,this.randomize=t=>t.sort((()=>.5-Math.random())),this.skuRow=t=>this.el(p(t)),this.categoryId=t=>`cat-${this.id(t,"-")}`,this.tab=t=>this.el(p(t)),this.live=(t,s)=>t.forEach((t=>t.classList[s]("-live"))),this.skuID=t=>t.name+"-"+ +new Date(t.sku),this.capitalize=t=>t[0].toUpperCase()+t.slice(1),this.isPast=t=>Date.now()>t&&Date.now()>this.endTime(t),this.isFuture=(t,s)=>-1===s.indexOf(t),this.digit=(t,s)=>0!==t?this.pad(t)+s:"",this.isATab=t=>t.classList.contains("-tab"),this.midnight=t=>+new Date(t).setHours(0,0,0,0)}getData(t){return this.remoteData.json_list.filter((s=>s.initiative===t))}group(t,s){const e=new Map;return s.map((s=>{const i=t.filter((t=>t.category===s)),a=this.randomize(i);e.set(s,a)})),e}pastAndFutureTimes(t){const s=t.filter(this.isPast),e=t.filter((t=>this.isFuture(t,s)));return{past:s,future:e}}timeUnits(t){const s=new Date(t);return{day:s.getDay(),month:s.getMonth(),date:s.getDate(),hour:s.getHours(),mins:s.getMinutes()}}toggle(t,s,e){t.forEach((t=>t.classList.remove(e))),s.classList.add(e)}price(t){const s=this.numFromStr(t);return`${this.currency} ${Number(s).toLocaleString()}`}numFromStr(t){return Number(t.replace(/[^0-9\.]+/g,""))}formatPrice(t){const s="prefix"===this.config.currency_position?`${this.currency} ${Number(t).toLocaleString()}`:`${Number(t).toLocaleString()} ${this.config.currency}`;return 0===Number(t)?"FREE":s}isANumber(t){const s=t.split(" ").filter((t=>!isNaN(Number(t))))[0];return isNaN(Number(s))?null:Number(s)}discount(t,s){const e=this.isANumber(t),i=this.isANumber(s);if(!isNaN(Number(e))){var a=100*(Number(e)-Number(i))/Number(e);return isNaN(a)?"":"-"+Math.round(a)+"%"}return null}replacePattern(t,s){const e=new RegExp(t,"g");return s.replace(e,"-")}id(t,s){const e=this.replacePattern("'",t),i=this.replacePattern("&",e);return this.replacePattern("%",i).toLowerCase().split(" ").join(s)}key(t,s){return t}dbConfigKey(t,s){return t}show(){let t=new this.fbox.ImageObserver;return t=null,this}platform(){const t="ontouchstart"in window,s=this.key("vote_deals_categories_mobile_banner",this.config),e=this.key("vote_deals_categories_desktop_banner",this.config),i=this.key("vote_deals_categories_deeplink",this.config),a=this.config[s],o=this.config[e],r=this.config[i];return{banner:t?a:o,live_link:t?r:`${this.domain.host}/${this.config.download_apps_page}`}}}class b extends g{constructor(s,e,i){super(s,e),this.options=i,this.$dbIdx=0,this.voteDBList=t,this.send=t=>this.fbox.pubsub.emit("votes available",t),this.FLStore=(t,s)=>JSON.parse(i.localStorage.getItem(t))||s,this.TLStore=(t,s)=>i.localStorage.setItem(t,JSON.stringify(s)),this.configs=this.voteDBList.map(this.str2Obj.bind(this)).map(this.firestore.bind(this)),console.log("this.configs are",this.configs)}regExReplace(t){return t.replace(/\"|\,/g,"")}str2Obj(t){const s=this.regExReplace(t).split("|"),e=this.partialConfig(s);let i={apiKey:"",appId:"",authDomain:"",databaseURL:"",messagingSenderId:"",projectId:"",storageBucket:""};return i.apiKey=e.apiKey,i.appId=e.appId,i.messagingSenderId=e.messagingSenderId,i.projectId=e.projectId,i.authDomain=e.projectId+".firebaseapp.com",i.databaseURL="https://"+e.projectId+".firebaseio.com",i.storageBucket=e.projectId+".appspot.com",i}partialConfig(t){let s={apiKey:"",appId:"",messagingSenderId:"",projectId:""};return t.map((t=>{const e=t.split("==");switch(e[0]){case"apiKey":s.apiKey=e[1];break;case"appId":s.appId=e[1];break;case"messagingSenderId":s.messagingSenderId=e[1];break;case"projectId":s.projectId=e[1]}})),s}firestore(t){const s=this.options.firebase.initializeApp(t,t.projectId),e=s.auth();return e.onAuthStateChanged((t=>{this.user=t,this.signIn(e)})),Object.assign(Object.assign({},t),{firestore:s.firestore()})}signIn(t){console.log("signing in"),t.signInWithEmailAndPassword(this.options.email,this.options.password).then((t=>this.load("from start"))).catch((s=>{"auth/user-not-found"===s.code&&this.signUp(t)}))}signUp(t){console.log("signing up"),t.createUserWithEmailAndPassword(this.options.email,this.options.password).then((t=>{console.log("account created")})).catch((t=>console.log(t)))}load(t){const s=this.dbIdx(t),i=this.configs[s];this.get(i.firestore,e).then(this.onSuccess.bind(this)).catch(this.onError.bind(this))}onSuccess(t){console.info("successfully retrieved data"),this.TLStore(s,t),this.send(t)}onError(t){console.info("error fetching data",t.message);const e=this.FLStore(s,{});this.send(e)}dbIdx(t){return"interval"===t?(this.$dbIdx++,this.$dbIdx>=this.configs.length?0:this.$dbIdx):this.$dbIdx}submit(t){console.log("user is",this.options.email),this.user?this.configs.map((s=>{this.save(s.firestore,t).then((()=>console.log("successfully saved in",s.projectId))).catch((t=>console.error("error submitting document",t)))})):console.log("you need to be signed in to store data")}save(t,s){return t.collection(e).doc("data").set(s,{merge:!0})}get(t,s){return t.collection(s).doc("data").get().then((t=>t.exists?t.data():{})).catch((t=>console.error(t)))}}class m extends g{constructor(t,s){super(t,s),this.skusEl=this.el(".-skus"),this.createSKUs=t=>t.map(this.skuHTML.bind(this)).join(""),this.skuHTML=t=>this.html(t),this.row=t=>this.el(`.-sku_row[data-category="${t}"]`),this.rows=()=>this.all(r),s.pubsub.subscribe(i,this.handleFocus.bind(this)),s.pubsub.subscribe(a,this.handleDisplay.bind(this))}reset(){this.skusEl.innerHTML=""}selectedRow(t){const s=(t=>`.-sku_row[data-category="${t}"]`)(t);return this.el(s)}handleFocus(t){const s=this.rows(),e=this.selectedRow(t);console.log("categoryId",t),this.toggle(s,e,l)}handleDisplay(t){this.reset();const{categories:s,map:e}=t;for(let[t,i]of e.entries())this.skusEl.innerHTML+=this.rowHTML(t,i,s);const i=this.categoryId(s[0]);this.handleFocus(i),this.show()}rowHTML(t,s,e){const i=this.createSKUs(s);return this.createRow(t,i,e)}createRow(t,s,e){return`<div class="${t===e[0]?"-sku_row -posrel active":h}" data-category="${this.categoryId(t)}">${s}</div>`}html(t){const s=this.price(t.old_price),e=this.price(t.new_price),i=this.discount(t.old_price,t.new_price),a=t.name+"-"+ +new Date;return`<div class="-sku -posrel -${t.status}" id="${this.id(a,"-")}"><a href="${t.pdp}" target="_blank" class="-img -posrel" ><span class="-posabs -preloader -loading"></span><div class="-posabs -shadow"><span class="-posabs">sold out</span></div><img class="lazy-image loaded" data-src="${t.image}" alt="sku_img" /></a><div class="-details -posabs"><div class="-name">${t.name}</div><div class="-prices"><div class="-price -new">${e}</div><div class="-price -old">${s}</div><div class="-disvcount">${i}</div></div></div><div class="-btns -posabs"><a href="${t.pdp}" target="_blank" class="-btn -view"></a><div class="-btn -unvote"></div><div class="-btn -vote"></div></div><div class="-vcounts -posabs"><div class="-ploader -unvotedown"></div><div class="-ploader -voteup"></div><div class="-vcount -down"><div class="-icon -unvote"></div><div class="-txt">8</div></div><div class="-vcount -up"><div class="-icon -vote"></div><div class="-txt">9</div></div></div></div>`}}class v extends g{constructor(t,s){super(t,s),this.$tabBounds={},this.tabs=this.el(".-all-tabs"),this.tabsParent=this.el(".-tabs"),this.prev=this.el(".-control.-prev"),this.next=this.el(".-control.-next"),s.pubsub.subscribe(a,this.build.bind(this)),this.tabs.addEventListener(n,this.tabListener.bind(this))}reset(){this.tabs.innerHTML=""}build(t){this.reset();const{categories:s}=t;console.log("first category from tab",s[0]),this.tabs.innerHTML=s.map(this.createTab.bind(this)).join("");const e=this.all(".-tab")[0];this.setTabProps(e,"first tab"),this.show(),!1===this.fbox.is_mobile&&this.scrollListeners()}scrollListeners(){this.next.addEventListener(n,(()=>this.scrollTo(d))),this.prev.addEventListener(n,(()=>this.scrollTo("prev")))}scrollTo(t){const s=t===d?this.tabs.scrollLeft+50:this.tabs.scrollLeft-50,e=(t===d?this.tabs.scrollLeft+300:this.tabs.scrollLeft-300)-s;this.tabs.scrollLeft=s+1*e}setTabProps(t,s){this.toggle(this.all(".-tab"),t,l),s===o&&this.fbox.pubsub.emit(i,t.getAttribute("data-category"))}createTab(t,s){return`<a href="#top" class="${0===s?"-tab active -inlineblock -posrel -vamiddle":"-tab -inlineblock -posrel -vamiddle"}" data-category="${this.categoryId(t)}"><span class="-posabs -preloader -loading"></span><span>${t}</span></a>`}tabListener(t){const s=t.target.parentElement;this.isATab(s)&&this.setTabProps(s,o)}}class f extends g{constructor(t,s,e){super(t,s),this.data=this.getData("Vote Deals Categories"),this.tandcs=this.getData("Vote Deals Categories T & Cs"),this.tandcsEl=this.el(".-re.-rules"),this.hiwCTA=this.el(".-how-it-works"),this.topBanner=this.el(".-banner.-top"),this.hiwCTA.addEventListener(n,this.toggleBanner.bind(this)),this.tabs=new v(t,s),this.skuRows=new m(t,s),this.database=new b(t,s,e),this.fbox.pubsub.subscribe("reset",this.init.bind(this)),this.init().setBanner().displayTAndCs().show()}init(){const t=this.allCategories(this.data),s=this.group(this.data,t),e=this.randomize(t);return this.fbox.pubsub.emit(a,{map:s,categories:e}),this}toggleBanner(){this.topBanner.classList.toggle("-show");const t=this.hiwCTA.querySelector(".-txt");t.textContent=(null==t?void 0:t.textContent)===c?"Close":c}setBanner(){return this.el(".-banner.-top img.lazy-image").setAttribute("data-src",this.platform().banner),this}displayTAndCs(){return this.tandcsEl.innerHTML=this.tandcs.map(this.tandcHTML.bind(this)).join(""),this}tandcHTML(t){return`<div class="-rule_element"><div class="-inlineblock -vatop -num">${t.sku}.</div><div class="-inlineblock -vatop -desc">${t.name}</div></div>`}}const w=window,I=w.Featurebox({config:{apiKey:"AIzaSyAA8dQEt-yZnDyY3Lra8lndRJ3LWNYVW0o",authDomain:"jumia-c15a3.firebaseapp.com",databaseURL:"https://jumia-c15a3.firebaseio.com",projectId:"jumia-c15a3",storageBucket:"jumia-c15a3.appspot.com",messagingSenderId:"295115190934",appId:"1:295115190934:web:de0b33b53a514c3c"},name:e}),y=w.firebase,L=w.store,k=w.btoa,_=w.localStorage;let S;const T={isLoggedIn:!1,email:"",pw:""},x=setInterval((()=>{if(/loaded|complete/.test(document.readyState)&&(clearInterval(x),T.email=L.customer.email,T.pw=k(T.email.split("").reverse().join("")),T.email.length>0)){T.isLoggedIn=!0;const t={email:T.email,password:T.pw,firebase:y,localStorage:_};I.pubsub.subscribe(I.FETCHED_DATA,(s=>{S=new f(s,I,t),S.getData("Vote Deals Categories")}))}}),10)})();
//# sourceMappingURL=bundle.js.map